



<div class="h-screen w-full bg-[#F3EFE0] flex flex-col overflow-hidden font-sans text-[#1a1a1a] dir-rtl relative">

  <div class="absolute top-[-20%] left-[-10%] w-[600px] h-[600px] bg-[#B08D55]/5 rounded-full blur-[120px] pointer-events-none"></div>

  <header class="flex-none px-8 py-5 flex justify-between items-center bg-[#F3EFE0] z-20">
    
   <div class="text-right">
        <h2 class="text-xl font-serif-display font-bold text-[#1a1a1a]">Dashboard</h2>
    </div>

    <div class="bg-white p-1.5 rounded-full border border-gray-200 shadow-sm flex">
        <button (click)="activeTab = 'users'" 
                [class.bg-[#1a1a1a]]="activeTab === 'users'"
                [class.text-white]="activeTab === 'users'"
                [class.text-gray-500]="activeTab !== 'users'"
                class="px-6 py-2 rounded-full font-medium transition-all duration-300 flex items-center gap-2 text-xs">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
          </svg>
          Users
        </button>

        <button (click)="activeTab = 'content'" 
                [class.bg-[#1a1a1a]]="activeTab === 'content'"
                [class.text-white]="activeTab === 'content'"
                [class.text-gray-500]="activeTab !== 'content'"
                class="px-6 py-2 rounded-full font-medium transition-all duration-300 flex items-center gap-2 text-xs">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
          </svg>
          Content
        </button>
    </div>

      <button (click)="logout()" class="group flex items-center gap-2 px-4 py-2 rounded-full border border-gray-300 bg-white text-gray-500 text-xs font-bold hover:bg-[#1a1a1a] hover:text-white hover:border-[#1a1a1a] transition-all">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 rotate-180 transition-transform">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
      </svg>
      <span>Log Out</span>
    </button>

  </header>


  <main class="flex-1 overflow-hidden p-6 pt-0">
    
    <div *ngIf="activeTab === 'users'" class="h-full grid grid-cols-1 lg:grid-cols-3 gap-6 animate-fade-in-up">
      
      <div class="lg:col-span-1 bg-white rounded-[2rem] border border-gray-100 shadow-sm flex flex-col overflow-hidden h-full">
         
         <div class="p-5 border-b border-gray-50 bg-gray-50/30 flex justify-between items-center flex-none">
            <h2 class="text-sm font-bold text-gray-800">Users List</h2>
            <span class="bg-[#B08D55]/10 text-[#B08D55] text-[10px] font-bold px-2 py-1 rounded-full">{{ users.length }} Total</span>
         </div>

         <div class="flex-1 overflow-y-auto p-3 space-y-2 custom-scrollbar">
            <div *ngFor="let user of users" (click)="selectUser(user)"
                 class="p-4 rounded-xl cursor-pointer transition-all duration-200 flex justify-between items-center group border border-transparent"
                 [class.bg-[#1a1a1a]]="selectedUser?.id === user.id"
                 [class.text-white]="selectedUser?.id === user.id"
                 [class.shadow-md]="selectedUser?.id === user.id"
                 [class.hover:bg-gray-50]="selectedUser?.id !== user.id">
              
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold"
                     [class.bg-white/20]="selectedUser?.id === user.id"
                     [class.text-white]="selectedUser?.id === user.id"
                     [class.bg-gray-100]="selectedUser?.id !== user.id"
                     [class.text-gray-500]="selectedUser?.id !== user.id">
                    {{ user.name.charAt(0) }}
                </div>
                <div>
                  <div class="font-bold text-sm">{{ user.name }}</div>
                  <div class="text-[10px] opacity-70">{{ user.phone }}</div>
                </div>
              </div>

              <div class="flex gap-1">
                 <button (click)="openEditUserModal(user, $event)" class="p-1.5  text-gray-400 hover:text-black hover:bg-gray-100 rounded-lg transition" title="Edit">
                   <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg>
                 </button>
                 <button (click)="deleteUser(user, $event)" class="p-1.5 hover:bg-red-50 text-gray-400 hover:text-red-500 rounded-lg transition" title="Delete">
                   <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" /></svg>
                 </button>
              </div>
            </div>
         </div>

         <div class="p-4 border-t border-gray-100 bg-gray-50/50 flex-none space-y-2">
            <button (click)="openAddUserModal()" class="w-full py-2.5 border border-dashed border-gray-300 rounded-lg text-gray-400 font-bold hover:text-[#B08D55] hover:border-[#B08D55] hover:bg-white transition text-xs flex justify-center gap-1">
              <span>+</span> Add New User
            </button>
            <div class="flex justify-between items-center">
              <button (click)="prevPage()" [disabled]="currentSkip === 0" class="text-[10px] px-3 py-1.5 bg-white border rounded hover:border-black disabled:opacity-50">← Prev</button>
              <span class="text-[10px] text-gray-400">Page {{ (currentSkip / limit) + 1 }}</span>
              <button (click)="nextPage()" [disabled]="users.length < limit" class="text-[10px] px-3 py-1.5 bg-white border rounded hover:border-black disabled:opacity-50">Next →</button>
            </div>
         </div>
      </div>

      <div class="lg:col-span-2 bg-white rounded-[2rem] border border-gray-100 shadow-sm flex flex-col overflow-hidden h-full relative">
         
         <div *ngIf="!selectedUser" class="flex-1 flex flex-col items-center justify-center text-gray-400">
           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" class="w-16 h-16 text-gray-200 mb-4"><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zm-7.518-.267A8.25 8.25 0 1120.25 10.5M8.288 14.212A5.25 5.25 0 1117.25 10.5" /></svg>
           <p class="text-sm">Select a user to view details</p>
         </div>

         <div *ngIf="selectedUser" class="flex flex-col h-full">
            <div class="p-6 border-b border-gray-100 bg-gray-50/30 flex-none">
               <h2 class="text-xs text-gray-400 font-bold uppercase tracking-wider">Learning History</h2>
               <h3 class="text-2xl font-serif-display font-bold text-[#1a1a1a]">{{ selectedUser.name }}</h3>
            </div>

            <div class="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar">
               <div *ngIf="userHistory.length === 0 && !isLoadingUsers" class="text-center py-10 text-gray-400 text-sm italic">No history available.</div>
               
               <div *ngFor="let item of userHistory" class="bg-white p-5 rounded-2xl border border-gray-100 shadow-[0_2px_8px_rgba(0,0,0,0.02)] hover:border-[#B08D55]/30 transition group">
                  <div class="flex gap-4">
                     <div class="mt-1 w-6 h-6 rounded-full bg-gray-50 flex items-center justify-center text-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" /></svg>
                     </div>
                     <div class="flex-1">
                        <div class="flex items-center gap-2 mb-2">
                           <span class="bg-[#B08D55]/10 text-[#B08D55] text-[10px] font-bold px-2 py-1 rounded-full">{{ getCategoryName(item.category_id) }}</span>
                           <span class="text-gray-300">→</span>
                           <span class="bg-gray-100 text-gray-600 text-[10px] font-bold px-2 py-1 rounded-full">{{ getSubCategoryName(item.sub_category_id) }}</span>
                        </div>
                        <p class="text-[#1a1a1a] font-medium text-base mb-3">{{ item.prompt }}</p>
                        <div class="bg-gray-50 p-4 rounded-xl text-sm text-gray-600 font-light leading-relaxed border border-gray-100">
                           {{ item.response }}
                        </div>
                        <div class="mt-2 text-right text-[10px] text-gray-400 font-medium">{{ item.created_at | date:'dd/MM/yy HH:mm' }}</div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
    </div>


    <div *ngIf="activeTab === 'content'" class="h-full flex flex-col animate-fade-in-up max-w-5xl mx-auto">
      
      <div class="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm mb-4 flex justify-between items-center flex-none">
         <h2 class="text-lg font-serif-display font-bold text-[#1a1a1a] px-2">Categories</h2>
         <button (click)="openAddCategoryModal()" class="bg-[#1a1a1a] hover:bg-[#B08D55] text-white font-bold py-2 px-4 rounded-xl transition text-xs flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
            New Topic
         </button>
      </div>

      <div class="flex-1 overflow-y-auto space-y-4 custom-scrollbar pb-10">
         <div *ngFor="let category of categories" class="bg-white border border-gray-100 rounded-2xl overflow-hidden hover:shadow-md transition-all">
            
            <div class="p-4 flex justify-between items-center border-b border-gray-50 bg-gray-50/30">
               <div class="flex items-center gap-3">
                  <div class="w-8 h-8 bg-white border border-gray-100 rounded-lg flex items-center justify-center text-gray-400">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" /></svg>
                  </div>
                  <span class="font-bold text-[#1a1a1a] text-sm">{{ category.name }}</span>
               </div>
               <div class="flex items-center gap-2">
                  <button (click)="openAddSubCategoryModal(category.id)" class="text-[10px] bg-[#B08D55]/10 text-[#B08D55] hover:bg-[#B08D55] hover:text-white px-3 py-1.5 rounded-lg transition font-bold border border-[#B08D55]/20">
                     + Sub
                  </button>
                  <div class="w-px h-4 bg-gray-200 mx-1"></div>
                  <button (click)="openEditContentModal(category)" class="p-1.5 hover:bg-gray-100 rounded-md text-gray-400 hover:text-black transition"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg></button>
                  <button (click)="deleteCategory(category.id)" class="p-1.5 hover:bg-red-50 rounded-md text-gray-400 hover:text-red-500 transition"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" /></svg></button>
               </div>
            </div>

            <div class="p-3 bg-white">
               <div *ngIf="!category.sub_categories.length"  class="text-xs text-gray-400 italic text-center py-2">Empty</div>
               
               <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                 <div *ngFor="let sub of category.sub_categories" class="flex justify-between items-center p-2.5 bg-gray-50 border border-gray-100 rounded-lg hover:border-gray-300 transition group">
                     
                     <div class="flex items-center gap-2">
                       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-gray-300 transform">
                         <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v7a4 4 0 0 0 4 4h12m-3-3l3 3m-3 3l3-3" />
                       </svg>
                       <span class="text-xs font-medium text-gray-600">{{ sub.name }}</span>
                     </div>
                     
                     <div class="flex items-center gap-1"> 
                       
                       <button (click)="openEditSubCategoryModal(sub, category.id)" 
                               class="p-1.5 rounded-md text-gray-400 hover:text-black hover:bg-gray-200 transition" 
                               title="Edit">
                           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5">
                               <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
                           </svg>
                       </button>

                       <button (click)="deleteSubCategory(sub.id)" 
                               class="p-1.5 rounded-md text-gray-400 hover:text-red-500 hover:bg-red-50 transition" 
                               title="Delete">
                           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5">
                               <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                           </svg>
                       </button>
                     </div>

                 </div>
               </div>
            </div>
         </div>
      </div>
    </div>

  </main>

  <div *ngIf="showUserModal || showCategoryModal" class="fixed inset-0 z-50 flex items-center justify-center bg-[#1a1a1a]/40 backdrop-blur-sm p-4 animate-fade-in">
     <div class="bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl p-10 relative animate-scale-up">
        <h2 class="text-2xl font-serif-display font-bold text-[#1a1a1a] text-center mb-6">
           {{ isEditing ? 'Edit' : 'Add' }} 
           <span *ngIf="showUserModal">User</span>
           <span *ngIf="!showUserModal && modalType === 'category'">Category</span>
           <span *ngIf="!showUserModal && modalType === 'sub-category'">Sub-Category</span>
        </h2>
        
        <form [formGroup]="showUserModal ? userForm : contentForm" (ngSubmit)="showUserModal ? saveUser() : saveContent()" class="space-y-4">
           <div>
              <label class="text-xs font-bold text-gray-400 uppercase ml-1">Name</label>
              <input formControlName="name" type="text" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-gray-900 focus:outline-none focus:ring-2 focus:ring-[#B08D55]/20 focus:border-[#B08D55] transition text-sm">
           </div>
           <div *ngIf="showUserModal">
              <label class="text-xs font-bold text-gray-400 uppercase ml-1">Phone</label>
              <input formControlName="phone" type="text" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-gray-900 focus:outline-none focus:ring-2 focus:ring-[#B08D55]/20 focus:border-[#B08D55] transition text-sm">
           </div>
           
           <div class="flex gap-3 pt-4">
              <button type="button" (click)="closeModal()" class="flex-1 py-3 rounded-xl border border-gray-200 text-gray-500 font-bold hover:bg-gray-50 transition text-sm">Cancel</button>
              <button type="submit" class="flex-1 bg-[#1a1a1a] text-white font-bold py-3 rounded-xl hover:bg-[#B08D55] transition shadow-lg text-sm">Save</button>
           </div>
        </form>
     </div>
  </div>

  <div *ngIf="showDeleteModal" class="fixed inset-0 z-[60] flex items-center justify-center bg-[#1a1a1a]/40 backdrop-blur-sm p-4 animate-fade-in">
    <div class="bg-white w-full max-w-sm rounded-[2rem] shadow-2xl p-8 relative animate-scale-up text-center border border-red-100">
       
       <div class="w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4 text-red-500">
         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
           <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
         </svg>
       </div>

       <h2 class="text-xl font-serif-display font-bold text-[#1a1a1a] mb-2">
         Are you sure?
       </h2>
       
       <p class="text-sm text-gray-500 mb-8 px-4">
         This action cannot be undone. 
         <span *ngIf="deleteType === 'user'">This user will be permanently deleted.</span>
         <span *ngIf="deleteType === 'category'">This category and all its topics will be lost.</span>
         <span *ngIf="deleteType === 'sub-category'">This sub-category will be deleted.</span>
       </p>
       
       <div class="flex gap-3">
         <button (click)="closeDeleteModal()" class="flex-1 py-3 rounded-xl border border-gray-200 text-gray-500 font-bold hover:bg-gray-50 transition text-sm">
             Cancel
         </button>
         <button (click)="confirmDelete()" class="flex-1 bg-red-500 text-white font-bold py-3 rounded-xl hover:bg-red-600 transition shadow-lg shadow-red-500/20 text-sm">
             Delete
         </button>
       </div>
    </div>
 </div>
</div>